{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'ICQL-DBA/DEMOS/TABULATE'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\n# test                      = require '../../../apps/guy-test'\n# PATH                      = require 'path'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  type_of\n  validate\n  validate_list_of }      = types.export()\n# { to_width }              = require 'to-width'\n# on_process_exit           = require 'exit-hook'\n# sleep                     = ( dts ) -> new Promise ( done ) => setTimeout done, dts * 1000\nSQL                       = String.raw\nTXT                       = require 'intertext'\n{ width_of }              = require 'to-width'\n{ lets\n  freeze }                = require 'letsfreezethat'\nSP                        = require 'steampipes'\n{ $\n  $watch\n  $drain }                = SP.export()\nguy                       = require 'guy'\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\ntypes.declare 'sql_limit', ( x ) ->\n  return true if @isa.nonempty_text x\n  return true if @isa.cardinal x\n  return false\n\n#-----------------------------------------------------------------------------------------------------------\ntypes.declare 'dbatbl_walk_relation_lines_cfg', tests:\n  \"@isa.object x\":                  ( x ) -> @isa.object x\n  \"@isa.sql_limit x.limit\":         ( x ) -> @isa.sql_limit x.limit\n  \"@isa.nonempty_text x.order_by\":  ( x ) -> @isa.nonempty_text x.order_by\n  \"@isa.nonempty_text x.schema\":    ( x ) -> @isa.nonempty_text x.schema\n  \"@isa.nonempty_text x.name\":      ( x ) -> @isa.nonempty_text x.name\n\n#-----------------------------------------------------------------------------------------------------------\ntypes.defaults =\n  dbatbl_walk_relation_lines_cfg:\n    limit:      10\n    order_by:   'random()'\n    schema:     'main'\n    name:       null\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nclass @Tbl\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    # validate.dbv_constructor_cfg @cfg = { types.defaults.dbv_constructor_cfg..., cfg..., }\n    @cfg = cfg\n    #.......................................................................................................\n    guy.props.def @, 'dba', { enumerable: false, value: cfg.dba, }\n    delete @cfg.dba\n    @cfg      = freeze @cfg\n    # @tabulate = guy.nowait.for_awaitable @tabulate_async\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _estimate_column_widths: ( query ) ->\n    preview_line_count  = 10 ### TAINT make configurable ###\n    line_count          = 0\n    R                   =\n      leading_rows: []\n      widths:       []\n    for row from query\n      line_count++\n      R.leading_rows.push row\n      for k, idx in Object.keys row\n        R.widths[ idx ] = Math.max ( R.widths[ idx ] ? 0 ), width_of rpr k\n        R.widths[ idx ] = Math.max ( R.widths[ idx ] ? 0 ), width_of rpr row[ k ]\n      # break if line_count >= preview_line_count\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT use `cfg` ###\n  _tabulate: ( query ) =>\n    ### TAINT cfg option: echo as-you-go ###\n    ### TAINT cfg option: return list of lines ###\n    ### TAINT cfg option: start with newline ###\n    R           = null\n    { leading_rows\n      widths  } = @_estimate_column_widths query\n    #.....................................................................................................\n    source      = SP.new_push_source()\n    pipeline    = []\n    pipeline.push source\n    # pipeline.push $watch ( d ) -> echo d\n    pipeline.push $ ( d, send ) =>\n      # debug '^76^', d\n      for k, v of d\n        switch type = type_of v\n          when 'text' then  d[ k ] = CND.blue v\n          else              d[ k ] = CND.white rpr v\n      send d\n    pipeline.push TXT.TBL.$tabulate { multiline: false, widths, }\n    pipeline.push $ ( d, send ) -> send d.text\n    pipeline.push $drain ( result ) -> R = result.join '\\n'\n    SP.pull pipeline...\n    #.....................................................................................................\n    source.send row for row in leading_rows\n    source.send row for row from query\n    source.end()\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT use `cfg` ###\n  walk_relation_lines: ( cfg ) ->\n    ### TAINT add support for schemas ###\n    validate.dbatbl_walk_relation_lines_cfg cfg = { types.defaults.dbatbl_walk_relation_lines_cfg..., cfg..., }\n    { schema\n      name\n      order_by\n      limit }       = cfg\n    schema_i        = @dba.sql.I schema\n    name_i          = schema_i + '.' + @dba.sql.I name\n    limit           = if cfg.limit is null then 1e9 else cfg.limit\n    #.......................................................................................................\n    ### TAINT implement in `Dba` ###\n    sample_row      = @dba.first_row @dba.query SQL\"select * from #{name_i} limit 1\"\n    col_names       = Object.keys sample_row\n    # order_by        = [ 1 .. col_names.length ].join ', '\n    #.......................................................................................................\n    ### TAINT implement in `Dba` ###\n    type            = @dba.first_value @dba.query SQL\"\"\"\n      select type from #{schema_i}.sqlite_schema\n      where name = $name\n      limit 1;\"\"\", { name, }\n    #.......................................................................................................\n    ### TAINT implement in `Dba` ###\n    row_count       = @dba.first_value @dba.query SQL\"select count(*) from #{name_i};\"\n    #.......................................................................................................\n    ### TAINT implement in `Dba` ###\n    query           = @dba.query SQL\"select * from #{name_i} order by #{order_by} limit #{limit};\"\n    #.......................................................................................................\n    yield \"\\n\"\n    if row_count > limit then yield \"#{type} #{name_i} (#{row_count} rows; first #{limit} shown)\"\n    else                      yield \"#{type} #{name_i} (all #{row_count} rows)\"\n    yield @_tabulate query\n    return null\n\n\n############################################################################################################\nif module is require.main then do =>\n\n\n\n\n\n\n\n"
  ]
}